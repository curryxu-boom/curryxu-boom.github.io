(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1217:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"站内信配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#站内信配置"}},[s._v("#")]),s._v(" 站内信配置")]),s._v(" "),t("p",[s._v("本章节，介绍项目的站内信功能。它在管理后台有三个菜单，分别是：")]),s._v(" "),t("p",[t("strong",[s._v("① 站内信模版：管理站内信的内容模版")])]),s._v(" "),t("img",{attrs:{src:a(674)}}),s._v(" "),t("p",[t("strong",[s._v("② 站内信管理：查看站内信的发送记录")])]),s._v(" "),t("img",{attrs:{src:a(675)}}),s._v(" "),t("p",[t("strong",[s._v("③ 我的站内信：查看发送给我的站内信")])]),s._v(" "),t("img",{attrs:{src:a(676)}}),s._v(" "),t("h2",{attrs:{id:"_1-表结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-表结构"}},[s._v("#")]),s._v(" 1. 表结构")]),s._v(" "),t("img",{attrs:{src:a(677)}}),s._v(" "),t("h2",{attrs:{id:"_2-实现代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现代码"}},[s._v("#")]),s._v(" 2. 实现代码")]),s._v(" "),t("ul",[t("li",[s._v("前端代码："),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-ui-admin/src/views/system/notify/",target:"_blank",rel:"noopener noreferrer"}},[s._v("views/system/notify"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("后端代码："),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/notify/",target:"_blank",rel:"noopener noreferrer"}},[s._v("controller/admin/notify"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"_3-站内信配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-站内信配置"}},[s._v("#")]),s._v(" 3. 站内信配置")]),s._v(" "),t("p",[s._v("本小节，讲解如何配置站内信功能，整个过程如下：")]),s._v(" "),t("ol",[t("li",[s._v("新建一个站内信【模版】，配置站内信的内容模版")]),s._v(" "),t("li",[s._v("测试该站内信模板，查看对应的站内信【记录】，确认是否发送成功")])]),s._v(" "),t("h3",{attrs:{id:"_3-1-新建站内信模版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-新建站内信模版"}},[s._v("#")]),s._v(" 3.1 新建站内信模版")]),s._v(" "),t("p",[s._v("① 点击 [系统管理 -> 站内信管理 -> 模板管理] 菜单，查看站内信模板的列表。如下图所示：")]),s._v(" "),t("img",{attrs:{src:a(678)}}),s._v(" "),t("p",[s._v("② 点击 [新增] 按钮，填写信息如下图：")]),s._v(" "),t("img",{attrs:{src:a(679)}}),s._v(" "),t("ul",[t("li",[s._v("模版编号：站内信模板的唯一标识，使用站内信 API 时，通过它标识使用的站内信模板")]),s._v(" "),t("li",[s._v("发件人名称：发送站内信显示的发件人名字")]),s._v(" "),t("li",[s._v("模板内容：站内信模板的内容，使用 "),t("code",[s._v("{var}")]),s._v(" 作为占位符，例如说 "),t("code",[s._v("{name}")]),s._v("、"),t("code",[s._v("{code}")]),s._v(" 等")]),s._v(" "),t("li",[s._v("模版类型：站内信的分类，可使用 "),t("code",[s._v("system_notify_template_type")]),s._v(" 字典进行自定义")]),s._v(" "),t("li",[s._v("开启状态：站内信模板被禁用时，该站内信模板将不发送站内信，只打印 logger 日志")])]),s._v(" "),t("p",[s._v("疑问：为什么设计站内信模板的功能？")]),s._v(" "),t("p",[s._v("在一些场景下，产品会希望修改发送站内信的内容、发送人昵称，此时只需要修改站内信模版的对应属性，无需重启应用。")]),s._v(" "),t("h3",{attrs:{id:"_3-2-测试站内信模版"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-测试站内信模版"}},[s._v("#")]),s._v(" 3.2 测试站内信模版")]),s._v(" "),t("p",[s._v("① 点击 [测试] 按钮，选择接收人为「芋道源码」，进行该站内信模板的模拟发送。如下图所示：")]),s._v(" "),t("img",{attrs:{src:a(680)}}),s._v(" "),t("p",[s._v("② 点击 [系统管理 -> 站内信管理 -> 消息记录] 菜单，可以查看到刚发送的站内信。如下图所示：")]),s._v(" "),t("img",{attrs:{src:a(681)}}),s._v(" "),t("p",[s._v("③ 点击右上角的 [消息] 图标，也可以查看到刚发送的站内信。如下图所示：")]),s._v(" "),t("img",{attrs:{src:a(682)}}),s._v(" "),t("h2",{attrs:{id:"_4-站内信发送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-站内信发送"}},[s._v("#")]),s._v(" 4. 站内信发送")]),s._v(" "),t("h3",{attrs:{id:"_4-1-notifymessagesendapi"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-notifymessagesendapi"}},[s._v("#")]),s._v(" 4.1 NotifyMessageSendApi")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://doc.iocoder.cn/#_3-%E7%AB%99%E5%86%85%E4%BF%A1%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[s._v("站内信配置"),t("OutboundLink")],1),s._v("完成后，可使用 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/api/notify/NotifyMessageSendApi.java",target:"_blank",rel:"noopener noreferrer"}},[s._v("NotifyMessageSendApi "),t("OutboundLink")],1),s._v("进行站内信的发送，支持多种用户类型。它的方法如下：")]),s._v(" "),t("img",{attrs:{src:a(683)}}),s._v(" "),t("h3",{attrs:{id:"_4-2-接入示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-接入示例"}},[s._v("#")]),s._v(" 4.2 接入示例")]),s._v(" "),t("p",[s._v("以 "),t("code",[s._v("yudao-module-infra")]),s._v(" 模块，需要发站内信为例子，讲解 SmsCodeApi 的使用。")]),s._v(" "),t("p",[s._v("① 在 "),t("code",[s._v("yudao-module-infra-biz")]),s._v(" 模块的 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/pom.xml",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("pom.xml")]),s._v(" "),t("OutboundLink")],1),s._v("引入 "),t("code",[s._v("yudao-module-system-api")]),s._v(" 依赖，如所示：")]),s._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("cn.iocoder.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("yudao-module-system-api"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${revision}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("② 在代码中注入 NotifyMessageSendApi Bean，并调用发送站内信的方法。代码如下：")]),s._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestDemoServiceImpl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TestDemoService")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 0. 注入 NotifyMessageSendApi Bean")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Resource")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NotifyMessageSendApi")]),s._v(" notifySendApi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendDemo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. 准备参数")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Long")]),s._v(" userId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1L")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 示例中写死，你可以改成你业务中的 userId 噢")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" templateCode "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test_01"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 站内信模版，记得在【站内信管理】中配置噢")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Object")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" templateParams "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("HashMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        templateParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"奥特曼"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        templateParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key2"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"变身"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. 发送站内信")]),s._v("\n        notifySendApi"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sendSingleNotifylToAdmin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NotifySendSingleToUserReqDTO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setUserId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTemplateCode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("templateCode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTemplateParams")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("templateParams"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports},674:function(s,t,a){s.exports=a.p+"assets/img/img_272.3a05ad94.png"},675:function(s,t,a){s.exports=a.p+"assets/img/img_273.fb308d69.png"},676:function(s,t,a){s.exports=a.p+"assets/img/img_274.2259f94c.png"},677:function(s,t,a){s.exports=a.p+"assets/img/img_275.8ed62749.png"},678:function(s,t,a){s.exports=a.p+"assets/img/img_276.3a05ad94.png"},679:function(s,t,a){s.exports=a.p+"assets/img/img_277.23b99b96.png"},680:function(s,t,a){s.exports=a.p+"assets/img/img_278.110df8d3.png"},681:function(s,t,a){s.exports=a.p+"assets/img/img_279.485f2850.png"},682:function(s,t,a){s.exports=a.p+"assets/img/img_280.4344cff3.png"},683:function(s,t,a){s.exports=a.p+"assets/img/img_281.ae5978f1.png"}}]);