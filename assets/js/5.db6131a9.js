(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1199:function(a,t,s){"use strict";s.r(t);var e=s(4),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"数据库-mybatis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库-mybatis"}},[a._v("#")]),a._v(" 数据库 MyBatis")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("yudao-spring-boot-starter-mybatis")]),a._v(" "),t("OutboundLink")],1),a._v("技术组件，基于 MyBatis Plus 实现数据库的操作。如果你没有学习过 MyBatis Plus，建议先阅读 "),t("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/MyBatis/?yudao",target:"_blank",rel:"noopener noreferrer"}},[a._v("《芋道 Spring Boot MyBatis 入门 》 "),t("OutboundLink")],1),a._v("文章。")]),a._v(" "),t("blockquote",[t("p",[a._v("友情提示")]),a._v(" "),t("p",[a._v("MyBatis 是最容易读懂的 Java 框架之一，感兴趣的话，可以看看艿艿写的 "),t("a",{attrs:{href:"https://www.iocoder.cn/MyBatis/good-collection/?yudao",target:"_blank",rel:"noopener noreferrer"}},[a._v("《芋道 MyBatis 源码解析》 "),t("OutboundLink")],1),a._v("系列，已经有 18000 人学习过！")])]),a._v(" "),t("h2",{attrs:{id:"_1-实体类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-实体类"}},[a._v("#")]),a._v(" 1. 实体类")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/dataobject/BaseDO.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("BaseDO "),t("OutboundLink")],1),a._v("是所有数据库实体的"),t("strong",[a._v("父类")]),a._v("，代码如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Data")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("abstract")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BaseDO")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Serializable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 创建时间\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("fill "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FieldFill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("INSERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Date")]),a._v(" createTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 最后更新时间\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("fill "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FieldFill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("INSERT_UPDATE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Date")]),a._v(" updateTime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 创建者，目前使用 AdminUserDO / MemberUserDO 的 id 编号\n     *\n     * 使用 String 类型的原因是，未来可能会存在非数值的情况，留好拓展性。\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("fill "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FieldFill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("INSERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" creator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 更新者，目前使用 AdminUserDO / MemberUserDO 的 id 编号\n     *\n     * 使用 String 类型的原因是，未来可能会存在非数值的情况，留好拓展性。\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("fill "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FieldFill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("INSERT_UPDATE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" updater"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 是否删除\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableLogic")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Boolean")]),a._v(" deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br")])]),t("ul",[t("li",[t("code",[a._v("createTime")]),a._v(" + "),t("code",[a._v("creator")]),a._v(" 字段，创建人相关信息。")]),a._v(" "),t("li",[t("code",[a._v("updater")]),a._v(" + "),t("code",[a._v("updateTime")]),a._v(" 字段，创建人相关信息。")]),a._v(" "),t("li",[t("code",[a._v("deleted")]),a._v(" 字段，逻辑删除。")])]),a._v(" "),t("p",[a._v("对应的 SQL 字段如下：")]),a._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("creator"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CHARACTER")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COLLATE")]),a._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'创建者'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("create_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("datetime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CURRENT_TIMESTAMP")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'创建时间'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("updater"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("varchar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("64")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CHARACTER")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SET")]),a._v(" utf8mb4 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COLLATE")]),a._v(" utf8mb4_unicode_ci "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("''")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'更新者'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("update_time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("datetime")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CURRENT_TIMESTAMP")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ON")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("UPDATE")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("CURRENT_TIMESTAMP")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'更新时间'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("deleted"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("bit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("DEFAULT")]),a._v(" b"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'0'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'是否删除'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("h3",{attrs:{id:"_1-1-主键编号"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-主键编号"}},[a._v("#")]),a._v(" 1.1 主键编号")]),a._v(" "),t("p",[t("code",[a._v("id")]),a._v(" 主键编号，推荐使用 Long 型自增，原因是：")]),a._v(" "),t("ul",[t("li",[a._v("自增，保证数据库是按顺序写入，性能更加优秀。")]),a._v(" "),t("li",[a._v("Long 型，避免未来业务增长，超过 Int 范围。")])]),a._v(" "),t("p",[a._v("对应的 SQL 字段如下：")]),a._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token identifier"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")]),a._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("bigint")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("NOT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("NULL")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("AUTO_INCREMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COMMENT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'编号'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("项目的 "),t("code",[a._v("id")]),a._v(" "),t("strong",[a._v("默认")]),a._v("采用数据库自增的策略，如果希望使用 Snowflake 雪花算法，可以修改 "),t("code",[a._v("application.yaml")]),a._v(" 配置文件，将配置项 "),t("code",[a._v("mybatis-plus.global-config.db-config.id-type")]),a._v(" 修改为 "),t("code",[a._v("ASSIGN_ID")]),a._v("。如下图所示：")]),a._v(" "),t("img",{attrs:{src:s(532)}}),a._v(" "),t("h3",{attrs:{id:"_1-2-逻辑删除"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-逻辑删除"}},[a._v("#")]),a._v(" 1.2 逻辑删除")]),a._v(" "),t("p",[a._v("所有表通过 "),t("code",[a._v("deleted")]),a._v(" 字段来实现逻辑删除，值为 0 表示未删除，值为 1 表示已删除，可见 "),t("code",[a._v("application.yaml")]),a._v(" 配置文件的 "),t("code",[a._v("logic-delete-value")]),a._v(" 和 "),t("code",[a._v("logic-not-delete-value")]),a._v(" 配置项。如下图所示：")]),a._v(" "),t("img",{attrs:{src:s(533)}}),a._v(" "),t("p",[a._v("① 所有 SELECT 查询，都会自动拼接 "),t("code",[a._v("WHERE deleted = 0")]),a._v(" 查询条件，过滤已经删除的记录。如果被删除的记录，只能通过在 XML 或者 "),t("code",[a._v("@SELECT")]),a._v(" 来手写 SQL 语句。例如说：")]),a._v(" "),t("img",{attrs:{src:s(534)}}),a._v(" "),t("p",[a._v("② 建立唯一索引时，需要额外增加 "),t("code",[a._v("delete_time")]),a._v(" 字段，添加到唯一索引字段中，避免唯一索引冲突。例如说，"),t("code",[a._v("system_users")]),a._v(" 使用 "),t("code",[a._v("username")]),a._v(" 作为唯一索引：")]),a._v(" "),t("ul",[t("li",[a._v("未添加前：先逻辑删除了一条 "),t("code",[a._v("username = yudao")]),a._v(" 的记录，然后又插入了一条 "),t("code",[a._v("username = yudao")]),a._v(" 的记录时，会报索引冲突的异常。")]),a._v(" "),t("li",[a._v("已添加后：先逻辑删除了一条 "),t("code",[a._v("username = yudao")]),a._v(" 的记录并更新 "),t("code",[a._v("delete_time")]),a._v(" 为当前时间，然后又插入一条 "),t("code",[a._v("username = yudao")]),a._v(" 并且 "),t("code",[a._v("delete_time")]),a._v(" 为 0 的记录，不会导致唯一索引冲突。")])]),a._v(" "),t("h3",{attrs:{id:"_1-3-自动填充"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-自动填充"}},[a._v("#")]),a._v(" 1.3 自动填充")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/handler/DefaultDBFieldHandler.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("DefaultDBFieldHandler "),t("OutboundLink")],1),a._v("基于 MyBatis 自动填充机制，实现 BaseDO 通用字段的自动设置。代码如下如：")]),a._v(" "),t("img",{attrs:{src:s(535)}}),a._v(" "),t("h3",{attrs:{id:"_1-4-复杂-字段类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-复杂-字段类型"}},[a._v("#")]),a._v(" 1.4 “复杂”字段类型")]),a._v(" "),t("p",[a._v("MyBatis Plus 提供 TypeHandler 字段类型处理器，用于 JavaType 与 JdbcType 之间的转换。示例如下：")]),a._v(" "),t("img",{attrs:{src:s(536)}}),a._v(" "),t("p",[a._v("常用的字段类型处理器有：")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/baomidou/mybatis-plus/blob/a3e121c27cd26cb7c546dfb88190f3b1f574dc38/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/handlers/JacksonTypeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("JacksonTypeHandler "),t("OutboundLink")],1),a._v("：通用的 Jackson 实现 JSON 字段类型处理器。")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/type/JsonLongSetTypeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("JsonLongSetTypeHandler "),t("OutboundLink")],1),a._v("：针对 "),t("code",[a._v("Set")]),a._v(" 的 Jackson 实现 JSON 字段类型处理器。")])]),a._v(" "),t("p",[a._v("另外，如果你后续要拓展自定义的 TypeHandler 实现，可以添加到 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/type/JsonLongSetTypeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("cn.iocoder.yudao.framework.mybatis.core.type")]),a._v(" "),t("OutboundLink")],1),a._v("包下。")]),a._v(" "),t("p",[a._v("注意事项：")]),a._v(" "),t("p",[a._v("使用 TypeHandler 时，需要设置实体的 "),t("code",[a._v("@TableName")]),a._v(" 注解的 "),t("code",[a._v("@autoResultMap = true")]),a._v("。")]),a._v(" "),t("h2",{attrs:{id:"_2-编码规范"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-编码规范"}},[a._v("#")]),a._v(" 2. 编码规范")]),a._v(" "),t("p",[a._v("① 数据库实体类放在 "),t("code",[a._v("dal.dataobject")]),a._v(" 包下，以 DO 结尾；数据库访问类放在 "),t("code",[a._v("dal.mysql")]),a._v(" 包下，以 Mapper 结尾。如下图所示：")]),a._v(" "),t("img",{attrs:{src:s(537)}}),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("② 数据库实体类的注释要完整，特别是哪些字段是关联（外键）、枚举、冗余等等。例如说：")]),a._v(" "),t("img",{attrs:{src:s(538)}}),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("③ 禁止在 Controller、Service 中，"),t("strong",[a._v("直接")]),a._v("进行 MyBatis Plus 操作。原因是：大量 MyBatis 操作散落在 Service 中，会导致 Service 的代码越来乱，无法聚焦业务逻辑。")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th"),a._v(" "),t("th",[a._v("示例")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("错误")]),a._v(" "),t("td",[t("img",{attrs:{src:s(539)}})])]),a._v(" "),t("tr",[t("td",[a._v("正确")]),a._v(" "),t("td",[t("img",{attrs:{src:s(540)}})])])])]),a._v(" "),t("p",[a._v("并且，通过只允许将 MyBatis Plus 操作编写 Mapper 层，更好的实现 SELECT 查询的复用，而不是 Service 会存在很多相同且重复的 SELECT 查询的逻辑。")]),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("④ Mapper 的 SELECT 查询方法的命名，采用 Spring Data 的 "),t("a",{attrs:{href:"https://docs.spring.io/spring-data/jpa/docs/2.2.0.RELEASE/reference/html/#jpa.query-methods.query-creation",target:"_blank",rel:"noopener noreferrer"}},[a._v('"Query methods" '),t("OutboundLink")],1),a._v("策略，方法名使用 "),t("code",[a._v("selectBy查询条件")]),a._v(" 规则。例如说：")]),a._v(" "),t("img",{attrs:{src:s(541)}}),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("⑤ 优先使用 LambdaQueryWrapper 条件构造器，使用方法获得字段名，避免手写 "),t("code",[a._v('"字段"')]),a._v(" 可能写错的情况。例如说：")]),a._v(" "),t("img",{attrs:{src:s(542)}}),a._v(" "),t("hr"),a._v(" "),t("p",[a._v("⑥ 简单的单表查询，优先在 Mapper 中通过 "),t("code",[a._v("default")]),a._v(" 方法实现。例如说：")]),a._v(" "),t("img",{attrs:{src:s(543)}}),a._v(" "),t("h2",{attrs:{id:"_3-crud-接口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-crud-接口"}},[a._v("#")]),a._v(" 3. CRUD 接口")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("BaseMapperX "),t("OutboundLink")],1),a._v("接口，继承 MyBatis Plus 的 BaseMapper 接口，提供更强的 CRUD 操作能力。")]),a._v(" "),t("h3",{attrs:{id:"_3-1-selectone"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-selectone"}},[a._v("#")]),a._v(" 3.1 selectOne")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L30-L44",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("#selectOne(...)")]),a._v(" "),t("OutboundLink")],1),a._v("方法，使用指定条件，查询单条记录。示例如下：")]),a._v(" "),t("img",{attrs:{src:s(544)}}),a._v(" "),t("h3",{attrs:{id:"_3-2-selectcount"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-selectcount"}},[a._v("#")]),a._v(" 3.2 selectCount")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L46-L56",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("#selectCount(...)")]),a._v(" "),t("OutboundLink")],1),a._v("方法，使用指定条件，查询记录的数量。示例如下：")]),a._v(" "),t("img",{attrs:{src:s(545)}}),a._v(" "),t("h3",{attrs:{id:"_3-3-selectlist"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-selectlist"}},[a._v("#")]),a._v(" 3.3 selectList")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L58-L76",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("#selectList(...)")]),a._v(" "),t("OutboundLink")],1),a._v("方法，使用指定条件，查询多条记录。示例如下：")]),a._v(" "),t("img",{attrs:{src:s(546)}}),a._v(" "),t("h3",{attrs:{id:"_3-4-selectpage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-selectpage"}},[a._v("#")]),a._v(" 3.4 selectPage")]),a._v(" "),t("p",[a._v("针对 MyBatis Plus 分页查询的二次分装，在 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("BaseMapperX "),t("OutboundLink")],1),a._v("中实现，目的是使用项目自己的分页封装：")]),a._v(" "),t("ul",[t("li",[a._v("【入参】查询前，将项目的分页参数 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/pojo/PageParam.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("PageParam "),t("OutboundLink")],1),a._v("，转换成 MyBatis Plus 的 IPage 对象。")]),a._v(" "),t("li",[a._v("【出参】查询后，将 MyBatis Plus 的分页结果 IPage，转换成项目的分页结果 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-common/src/main/java/cn/iocoder/yudao/framework/common/pojo/PageResult.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("PageResult "),t("OutboundLink")],1),a._v("。代码如下图：")])]),a._v(" "),t("img",{attrs:{src:s(547)}}),a._v(" "),t("p",[a._v("具体的使用示例，可见 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/mysql/tenant/TenantMapper.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("TenantMapper "),t("OutboundLink")],1),a._v("类中，定义 selectPage 查询方法。代码如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Mapper")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantMapper")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BaseMapperX")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PageResult")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("selectPage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantPageReqVO")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("selectPage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LambdaQueryWrapperX")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("likeIfPresent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 如果 name 不为空，则进行 like 查询")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("likeIfPresent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getContactName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getContactName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("likeIfPresent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getContactMobile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getContactMobile")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("eqIfPresent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getStatus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 如果 status 不为空，则进行 = 查询")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("betweenIfPresent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getCreateTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getBeginCreateTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" reqVO"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getEndCreateTime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 如果 create 不为空，则进行 between 查询")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("orderByDesc")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TenantDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 按照 id 倒序")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("完整实战，可见 "),t("a",{attrs:{href:"https://doc.iocoder.cn/page-feature",target:"_blank",rel:"noopener noreferrer"}},[a._v("《开发指南 —— 分页实现》"),t("OutboundLink")],1),a._v(" 文档。")]),a._v(" "),t("h3",{attrs:{id:"_3-5-insertbatch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-insertbatch"}},[a._v("#")]),a._v(" 3.5 insertBatch")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/mapper/BaseMapperX.java#L78-L88",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("#insertBatch(...)")]),a._v(" "),t("OutboundLink")],1),a._v("方法，遍历数组，逐条插入数据库中，适合"),t("strong",[a._v("少量")]),a._v("数据插入，或者对"),t("strong",[a._v("性能要求不高")]),a._v("的场景。 示例如下：")]),a._v(" "),t("img",{attrs:{src:s(548)}}),a._v(" "),t("p",[a._v("为什么不使用 insertBatchSomeColumn 批量插入？")]),a._v(" "),t("ul",[t("li",[a._v("只支持 MySQL 数据库。其它 Oracle 等数据库使用会报错，可见 "),t("a",{attrs:{href:"https://github.com/baomidou/mybatis-plus/blob/a3e121c27cd26cb7c546dfb88190f3b1f574dc38/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/injector/methods/InsertBatchSomeColumn.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("InsertBatchSomeColumn "),t("OutboundLink")],1),a._v("说明。")]),a._v(" "),t("li",[a._v("未支持多租户。插入数据库时，多租户字段不会进行自动赋值。")])]),a._v(" "),t("h2",{attrs:{id:"_4-批量插入"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-批量插入"}},[a._v("#")]),a._v(" 4. 批量插入")]),a._v(" "),t("p",[a._v("绝大多数场景下，推荐使用 MyBatis Plus 提供的 IService 的 "),t("a",{attrs:{href:"https://github.com/baomidou/mybatis-plus/blob/34ebdf6ee6/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/service/IService.java#L66-L74",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("#saveBatch()")]),a._v(" "),t("OutboundLink")],1),a._v("方法。示例 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/permission/PermissionServiceImpl.java#L200-L230",target:"_blank",rel:"noopener noreferrer"}},[a._v("PermissionServiceImpl "),t("OutboundLink")],1),a._v("如下：")]),a._v(" "),t("img",{attrs:{src:s(549)}}),a._v(" "),t("h2",{attrs:{id:"_5-条件构造器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-条件构造器"}},[a._v("#")]),a._v(" 5. 条件构造器")]),a._v(" "),t("p",[a._v("继承 MyBatis Plus 的条件构造器，拓展了 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/query/LambdaQueryWrapperX.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("LambdaQueryWrapperX "),t("OutboundLink")],1),a._v("和 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/query/QueryWrapperX.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("QueryWrapperX "),t("OutboundLink")],1),a._v("类，主要是增加 xxxIfPresent 方法，用于判断值不存在的时候，不要拼接到条件中。例如说：")]),a._v(" "),t("img",{attrs:{src:s(550)}}),a._v(" "),t("p",[a._v("具体的使用示例如下：")]),a._v(" "),t("img",{attrs:{src:s(551)}}),a._v(" "),t("h2",{attrs:{id:"_6-mapper-xml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-mapper-xml"}},[a._v("#")]),a._v(" 6. Mapper XML")]),a._v(" "),t("p",[a._v("默认配置下，MyBatis Mapper XML 需要写在各 "),t("code",[a._v("yudao-module-xxx-biz")]),a._v(" 模块的 "),t("code",[a._v("resources/mapper")]),a._v(" 目录下。示例 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/resources/mapper/test/TestDemoMapper.xml",target:"_blank",rel:"noopener noreferrer"}},[a._v("TestDemoMapper.xml "),t("OutboundLink")],1),a._v("如下：")]),a._v(" "),t("img",{attrs:{src:s(552)}}),a._v(" "),t("p",[a._v("尽量避免数据库的连表（多表）查询，而是采用多次查询，Java 内存拼接的方式替代。例如说：")]),a._v(" "),t("img",{attrs:{src:s(553)}}),a._v(" "),t("h2",{attrs:{id:"_7-字段加密"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-字段加密"}},[a._v("#")]),a._v(" 7. 字段加密")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-mybatis/src/main/java/cn/iocoder/yudao/framework/mybatis/core/type/EncryptTypeHandler.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("EncryptTypeHandler "),t("OutboundLink")],1),a._v("，基于 "),t("a",{attrs:{href:"https://apidoc.gitee.com/dromara/hutool/cn/hutool/crypto/symmetric/AES.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Hutool AES "),t("OutboundLink")],1),a._v("实现字段的解密与解密。")]),a._v(" "),t("p",[a._v("例如说，"),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/db/DataSourceConfigDO.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("数据源配置 "),t("OutboundLink")],1),a._v("的 "),t("code",[a._v("password")]),a._v(" 密码需要实现加密存储，则只需要在该字段上添加 EncryptTypeHandler 处理器。示例代码如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("value "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"infra_data_source_config"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" autoResultMap "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ① 添加 autoResultMap = true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DataSourceConfigDO")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BaseDO")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ... 省略其它字段")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 密码\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@TableField")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("typeHandler "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EncryptTypeHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ② 添加 EncryptTypeHandler 处理器")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" password"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("p",[a._v("另外，在 "),t("code",[a._v("application.yaml")]),a._v(" 配置文件中，可使用 "),t("code",[a._v("mybatis-plus.encryptor.password")]),a._v(" 设置加密密钥。")]),a._v(" "),t("p",[a._v("字段加密后，只允许使用"),t("strong",[a._v("精准")]),a._v("匹配，无法使用模糊匹配。示例代码如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Test")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 测试使用 password 查询，可以查询到数据")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("testSelectPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// mock 数据")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DataSourceConfigDO")]),a._v(" dbDataSourceConfig "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("randomPojo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DataSourceConfigDO")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    dataSourceConfigMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("insert")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("dbDataSourceConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// @Sql: 先插入出一条存在的数据")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 调用")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DataSourceConfigDO")]),a._v(" result "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" dataSourceConfigMapper"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("selectOne")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DataSourceConfigDO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("EncryptTypeHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("encrypt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("dbDataSourceConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 重点：需要使用 EncryptTypeHandler 去加密查询字段！！！")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])])])}),[],!1,null,null,null);t.default=n.exports},532:function(a,t,s){a.exports=s.p+"assets/img/img_144.cb248020.png"},533:function(a,t,s){a.exports=s.p+"assets/img/img_145.d8536943.png"},534:function(a,t,s){a.exports=s.p+"assets/img/img_146.daa92c47.png"},535:function(a,t,s){a.exports=s.p+"assets/img/img_147.789fe0d5.png"},536:function(a,t,s){a.exports=s.p+"assets/img/img_148.f64d89da.png"},537:function(a,t,s){a.exports=s.p+"assets/img/img_149.7d94c2f3.png"},538:function(a,t,s){a.exports=s.p+"assets/img/img_150.fbdd1fae.png"},539:function(a,t,s){a.exports=s.p+"assets/img/img_151.2877ae47.png"},540:function(a,t,s){a.exports=s.p+"assets/img/img_152.665f02d1.png"},541:function(a,t,s){a.exports=s.p+"assets/img/img_153.a8fd9342.png"},542:function(a,t,s){a.exports=s.p+"assets/img/img_154.6cd4cdcd.png"},543:function(a,t,s){a.exports=s.p+"assets/img/img_155.a1f7d375.png"},544:function(a,t,s){a.exports=s.p+"assets/img/img_156.d77417a6.png"},545:function(a,t,s){a.exports=s.p+"assets/img/img_157.9f0685dd.png"},546:function(a,t,s){a.exports=s.p+"assets/img/img_158.a1f7d375.png"},547:function(a,t,s){a.exports=s.p+"assets/img/img_159.ddc20499.png"},548:function(a,t,s){a.exports=s.p+"assets/img/img_160.f3955a31.png"},549:function(a,t,s){a.exports=s.p+"assets/img/img_161.c879cb83.png"},550:function(a,t,s){a.exports=s.p+"assets/img/img_162.9ab4abee.png"},551:function(a,t,s){a.exports=s.p+"assets/img/img_163.cac36d4a.png"},552:function(a,t,s){a.exports=s.p+"assets/img/img_164.b957f3f5.png"},553:function(a,t,s){a.exports=s.p+"assets/img/img_165.4d2e4126.png"}}]);