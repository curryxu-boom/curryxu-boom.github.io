(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1198:function(e,r,o){"use strict";o.r(r);var a=o(4),t=Object(a.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"系统日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#系统日志"}},[e._v("#")]),e._v(" 系统日志")]),e._v(" "),r("p",[e._v("项目提供 2 类 4 种系统日志：")]),e._v(" "),r("ul",[r("li",[e._v("审计日志：用户的操作日志、登录日志")]),e._v(" "),r("li",[e._v("API 日志：RESTful API 的访问日志、错误日志")])]),e._v(" "),r("h2",{attrs:{id:"_1-操作日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-操作日志"}},[e._v("#")]),e._v(" 1. 操作日志")]),e._v(" "),r("p",[e._v("操作日志，记录「谁」在「什么时间」对「什么对象」做了「什么事情」。")]),e._v(" "),r("p",[e._v("打开 [系统管理 -> 审计日志 -> 操作日志] 菜单，可以看到对应的列表，如下图所示：")]),e._v(" "),r("img",{attrs:{src:o(519)}}),e._v(" "),r("p",[e._v("操作日志的记录，由 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-operatelog/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("yudao-spring-boot-starter-biz-operatelog")]),e._v(" "),r("OutboundLink")],1),e._v("技术组件实现，"),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-operatelog/src/main/java/cn/iocoder/yudao/framework/operatelog/core/aop/OperateLogAspect.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateLogAspect "),r("OutboundLink")],1),e._v("通过 Spring AOP 拦声明了 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-operatelog/src/main/java/cn/iocoder/yudao/framework/operatelog/core/annotations/OperateLog.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("@OperateLog")]),e._v(" "),r("OutboundLink")],1),e._v("注解的方法，"),r("strong",[e._v("异步")]),e._v("记录日志。使用示例如下：")]),e._v(" "),r("img",{attrs:{src:o(520)}}),e._v(" "),r("p",[e._v("操作日志的存储，由 "),r("code",[e._v("yudao-module-system")]),e._v(" 的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/OperateLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateLog "),r("OutboundLink")],1),e._v("模块实现，记录到数据库的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/logger/OperateLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("system_operate_log")]),e._v(" "),r("OutboundLink")],1),e._v("表。")]),e._v(" "),r("h3",{attrs:{id:"_1-1-operatelog-注解"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-operatelog-注解"}},[e._v("#")]),e._v(" 1.1 "),r("code",[e._v("@OperateLog")]),e._v(" 注解")]),e._v(" "),r("p",[r("code",[e._v("@OperateLog")]),e._v(" 注解，一共有 6 个属性，如下图所示：")]),e._v(" "),r("img",{attrs:{src:o(521)}}),e._v(" "),r("ul",[r("li",[r("code",[e._v("module")]),e._v(" 属性：操作模块，例如说：用户、岗位、部门等等。为空时，默认会读取类上的 Swagger "),r("code",[e._v("@Tag")]),e._v(" 注解的 "),r("code",[e._v("name")]),e._v(" 属性。")]),e._v(" "),r("li",[r("code",[e._v("name")]),e._v(" 属性：操作名，例如说：新增用户、修改用户等等。为空时，默认会读取方法的 Swagger "),r("code",[e._v("@Operation")]),e._v(" 注解的 "),r("code",[e._v("summary")]),e._v(" 属性。")]),e._v(" "),r("li",[r("code",[e._v("type")]),e._v(" 属性：操作类型，在 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-operatelog/src/main/java/cn/iocoder/yudao/framework/operatelog/core/enums/OperateTypeEnum.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateTypeEnum "),r("OutboundLink")],1),e._v("枚举。目前有 "),r("code",[e._v("GET")]),e._v(" 查询、"),r("code",[e._v("CREATE")]),e._v(" 新增、"),r("code",[e._v("UPDATE")]),e._v(" 修改、"),r("code",[e._v("DELETE")]),e._v(" 删除、"),r("code",[e._v("EXPORT")]),e._v(" 导出、"),r("code",[e._v("IMPORT")]),e._v(" 导入、"),r("code",[e._v("OTHER")]),e._v(" 其它，可进行自定义。")])]),e._v(" "),r("h3",{attrs:{id:"_1-2-自动记录"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-自动记录"}},[e._v("#")]),e._v(" 1.2 自动记录")]),e._v(" "),r("p",[e._v("操作日志往往记录的是针对某个对象的"),r("strong",[e._v("写")]),e._v("操作，所以针对 POST、PUT、DELETE 等写请求，"),r("code",[e._v("yudao-spring-boot-starter-biz-operatelog")]),e._v(" 组件会自动记录操作日志。")]),e._v(" "),r("ul",[r("li",[e._v("基于请求方法，转换出对应的 "),r("code",[e._v("type")]),e._v(" 操作方法：POST 对应 "),r("code",[e._v("CREATE")]),e._v(" 类型，PUT 对应 "),r("code",[e._v("UPDATE")]),e._v(" 类型，DELETE 对应 "),r("code",[e._v("DELETE")]),e._v(" 类型，其它对应 "),r("code",[e._v("OTHER")]),e._v(" 类型。")]),e._v(" "),r("li",[e._v("基于 Swagger 注解，转换出对应的 "),r("code",[e._v("module")]),e._v(" 操作模块、"),r("code",[e._v("name")]),e._v(" 操作名。")])]),e._v(" "),r("p",[e._v("因此，绝大多数 RESTful API 对应的方法，无需添加 "),r("code",[e._v("@OperateLog")]),e._v(" 注解。例如说：")]),e._v(" "),r("img",{attrs:{src:o(522)}}),e._v(" "),r("p",[e._v("一般来说，只有两种场景需要添加 "),r("code",[e._v("@OperateLog")]),e._v(" 注解。")]),e._v(" "),r("p",[e._v("① 场景一：需要自定义 "),r("code",[e._v("@OperateLog")]),e._v(" 注解的属性。例如说：")]),e._v(" "),r("img",{attrs:{src:o(523)}}),e._v(" "),r("p",[e._v("② 场景二：不想自动记录操作日志。例如说：")]),e._v(" "),r("img",{attrs:{src:o(524)}}),e._v(" "),r("h3",{attrs:{id:"_1-3-后续优化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-后续优化"}},[e._v("#")]),e._v(" 1.3 后续优化")]),e._v(" "),r("p",[r("code",[e._v("yudao-spring-boot-starter-biz-operatelog")]),e._v(" 组件目前提供的是"),r("strong",[e._v("轻量级")]),e._v("的操作日志的解决方案，暂时未提供很好的记录操作对应、操作明细、拓展字段的能力。例如说：")]),e._v(" "),r("img",{attrs:{src:o(525)}}),e._v(" "),r("ul",[r("li",[e._v("【新增】2021-09-16 10:00 订单创建，订单号：NO.11089999，其中涉及变量订单号 “NO.11089999”")]),e._v(" "),r("li",[e._v("【修改】2021-09-16 10:00 用户小明修改了订单的配送地址：从 “金灿灿小区” 修改到 “银盏盏小区”")])]),e._v(" "),r("p",[e._v("未来，艿艿会引入老友开源的 "),r("a",{attrs:{href:"https://github.com/mouzt/mzt-biz-log",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/mouzt/mzt-biz-log "),r("OutboundLink")],1),e._v("操作日志组件，优化项目的操作日志功能。大家记得给个 Star 哟！")]),e._v(" "),r("p",[e._v("目前，如果要记录具体的操作明细、拓展字段，可以调用 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-biz-operatelog/src/main/java/cn/iocoder/yudao/framework/operatelog/core/util/OperateLogUtils.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("OperateLogUtils "),r("OutboundLink")],1),e._v("的静态方法，代码如下：")]),e._v(" "),r("img",{attrs:{src:o(526)}}),e._v(" "),r("h2",{attrs:{id:"_2-登录日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录日志"}},[e._v("#")]),e._v(" 2. 登录日志")]),e._v(" "),r("p",[e._v("登录日志，记录用户的登录、登出行为，包括成功的、失败的。")]),e._v(" "),r("p",[e._v("打开 [系统管理 -> 审计日志 -> 登录日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),r("img",{attrs:{src:o(527)}}),e._v(" "),r("p",[e._v("登录日志的存储，由 "),r("code",[e._v("yudao-module-system")]),e._v(" 的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/LoginLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginLog "),r("OutboundLink")],1),e._v("模块实现，记录到数据库的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/dal/dataobject/logger/LoginLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("system_login_log")]),e._v(" "),r("OutboundLink")],1),e._v("表。")]),e._v(" "),r("p",[e._v("登录类型通过 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/logger/LoginLogTypeEnum.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginLogTypeEnum "),r("OutboundLink")],1),e._v("枚举，登录结果通过 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-api/src/main/java/cn/iocoder/yudao/module/system/enums/logger/LoginResultEnum.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("LoginResultEnum "),r("OutboundLink")],1),e._v("枚举，都可以自定义。代码如下：")]),e._v(" "),r("img",{attrs:{src:o(528)}}),e._v(" "),r("h2",{attrs:{id:"_3-api-访问日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-api-访问日志"}},[e._v("#")]),e._v(" 3. API 访问日志")]),e._v(" "),r("p",[e._v("API 访问日志，记录 API 的每次调用，包括 HTTP 请求、用户、开始时间、时长等等信息。")]),e._v(" "),r("p",[e._v("打开 [基础设施 -> API 日志 -> 访问日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),r("img",{attrs:{src:o(529)}}),e._v(" "),r("p",[e._v("访问日志的记录，由 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("yudao-spring-boot-starter-web")]),e._v(" "),r("OutboundLink")],1),e._v("技术组件实现，通过 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/apilog/core/filter/ApiAccessLogFilter.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ApiAccessLogFilter "),r("OutboundLink")],1),e._v("过滤 RESTful API 请求，"),r("strong",[e._v("异步")]),e._v("记录日志。")]),e._v(" "),r("p",[e._v("访问日志的存储，由 "),r("code",[e._v("yudao-module-infra")]),e._v(" 的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiAccessLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("AccessLog "),r("OutboundLink")],1),e._v("模块实现，记录到数据库的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/logger/ApiAccessLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("infra_api_access_log")]),e._v(" "),r("OutboundLink")],1),e._v("表。")]),e._v(" "),r("h2",{attrs:{id:"_4-api-错误日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-api-错误日志"}},[e._v("#")]),e._v(" 4. API 错误日志")]),e._v(" "),r("p",[e._v("API 错误日志，记录每次 API 的异常调用，包括 HTTP 请求、用户、异常的堆栈等等信息。")]),e._v(" "),r("p",[e._v("打开 [基础设施 -> API 日志 -> 错误日志] 菜单，可以看对应的列表，如下图所示：")]),e._v(" "),r("img",{attrs:{src:o(530)}}),e._v(" "),r("p",[e._v("错误日志的记录，由 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("yudao-spring-boot-starter-web")]),e._v(" "),r("OutboundLink")],1),e._v("技术组件实现，通过 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-web/src/main/java/cn/iocoder/yudao/framework/web/core/handler/GlobalExceptionHandler.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("GlobalExceptionHandler "),r("OutboundLink")],1),e._v("拦截每次 RESTful API 的系统异常，"),r("strong",[e._v("异步")]),e._v("记录日志。")]),e._v(" "),r("img",{attrs:{src:o(531)}}),e._v(" "),r("p",[e._v("错误日志的存储，由 "),r("code",[e._v("yudao-module-infra")]),e._v(" 的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiErrorLogServiceImpl.java",target:"_blank",rel:"noopener noreferrer"}},[e._v("ErrorLog "),r("OutboundLink")],1),e._v("模块实现，记录到数据库的 "),r("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/dal/dataobject/logger/ApiErrorLogDO.java",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("infra_api_error_log")]),e._v(" "),r("OutboundLink")],1),e._v("表。")])])}),[],!1,null,null,null);r.default=t.exports},519:function(e,r,o){e.exports=o.p+"assets/img/img_131.a951ce46.png"},520:function(e,r,o){e.exports=o.p+"assets/img/img_132.bfe7cd71.png"},521:function(e,r,o){e.exports=o.p+"assets/img/img_133.8d042e25.png"},522:function(e,r,o){e.exports=o.p+"assets/img/img_134.873d5bf4.png"},523:function(e,r,o){e.exports=o.p+"assets/img/img_135.b9feaec7.png"},524:function(e,r,o){e.exports=o.p+"assets/img/img_136.0c8abf26.png"},525:function(e,r,o){e.exports=o.p+"assets/img/img_143.9618cb40.png"},526:function(e,r,o){e.exports=o.p+"assets/img/img_137.4ed65f25.png"},527:function(e,r,o){e.exports=o.p+"assets/img/img_138.b617652b.png"},528:function(e,r,o){e.exports=o.p+"assets/img/img_139.42ed5e74.png"},529:function(e,r,o){e.exports=o.p+"assets/img/img_140.c4f05852.png"},530:function(e,r,o){e.exports=o.p+"assets/img/img_141.29322019.png"},531:function(e,r,o){e.exports=o.p+"assets/img/img_142.09601abf.png"}}]);