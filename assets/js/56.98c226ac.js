(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{334:function(s,a,t){s.exports=t.p+"assets/img/1597132842826.d9f342c3.png"},335:function(s,a,t){s.exports=t.p+"assets/img/1622165065(1).19485467.png"},336:function(s,a,t){s.exports=t.p+"assets/img/1622165131(1).a723526d.png"},993:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose使用"}},[s._v("#")]),s._v(" docker-compose使用")]),s._v(" "),a("p",[a("code",[s._v("docker-compose")]),s._v(" 是用来干嘛的呢? 简单的说 是用来进行容器编排的  简单的说我们在运行 一些列容器的时候  容器的初始化可以拥有顺序")]),s._v(" "),a("img",{attrs:{src:t(334)}}),s._v(" "),a("h2",{attrs:{id:"安装docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-compose"}},[s._v("#")]),s._v(" 安装docker-compose")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装依赖")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装PIP")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python-pip\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#升级PIP")]),s._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--upgrade")]),s._v(" pip\n\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" docker-compose"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.23")]),s._v(".2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"编写dockerfile文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写dockerfile文件"}},[s._v("#")]),s._v(" 编写Dockerfile文件")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("FROM java:8\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v("\nADD admin-0.0.1-SNAPSHOT.jar app.jar\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'touch /app.jar'")]),s._v("\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app.jar"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--spring.profiles.active=pro"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("上面几行命令其实很简单，首先依赖"),a("code",[s._v("jdk8")]),s._v("环境，对外暴露"),a("code",[s._v("8080")]),s._v("，然后就是复制"),a("code",[s._v("xxx-0.0.1-SNAPSHOT.jar")]),s._v("到"),a("code",[s._v("docker容器")]),s._v("中并命名为"),a("code",[s._v("app.jar")]),s._v("，最后是执行命令")]),s._v(" "),a("p",[a("code",[s._v("java -jar /app.jar --spring.profiles.active=pro")]),s._v("，使用的是我们另外编写的一个线上环境配置。")])]),s._v(" "),a("h2",{attrs:{id:"编写-docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写-docker-compose-yml"}},[s._v("#")]),s._v(" 编写 docker-compose.yml")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#服务名称 用户自己定义")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 镜像版本")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token datetime number"}},[s._v("80:80")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口 右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /root/nginx/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/usr/share/nginx/html\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /root/nginx/nginx.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/nginx.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这个必须要，解决nginx的文件调用的权限问题")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8.0.19\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 3306"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定用户root的密码")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=123456\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("myServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" myServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" . "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示以当前目录下的Dockerfile开始构建镜像 所以这个yml文件和dockerFile文件要放一起")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8081"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右边是真实端口，左边是暴露在外的端口")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 依赖与mysql、redis，其实可以不填，默认已经表示可以")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mysql\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h2",{attrs:{id:"修改application-pro-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改application-pro-yml"}},[s._v("#")]),s._v(" 修改application-pro.yml")]),s._v(" "),a("p",[s._v("然后我们再回头看看"),a("code",[s._v("application-pro.yml")]),s._v("文件，"),a("code",[s._v("mysql")]),s._v("和"),a("code",[s._v("redis")]),s._v("的链接之前还是"),a("code",[s._v("localhost")]),s._v("，现在我们需要修改成容器之间的调用，如何知道"),a("code",[s._v("mysql")]),s._v("和"),a("code",[s._v("redis")]),s._v("的链接地址呢？docker compose就帮我们解决了这个问题，我们可以使用镜像容器的服务名称来表示链接。比如docker-compose.yml中mysql的服务名称就叫mysql、redis就叫redis。")]),s._v(" "),a("img",{attrs:{src:t(335)}}),s._v(" "),a("p",[s._v("所以我们最终得到的配置文件如下：")]),s._v(" "),a("img",{attrs:{src:t(336)}}),s._v(" "),a("h2",{attrs:{id:"准备好nginx的挂载目录和配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备好nginx的挂载目录和配置"}},[s._v("#")]),s._v(" 准备好nginx的挂载目录和配置")]),s._v(" "),a("p",[s._v("docker-compose.yml中已经提到，")]),s._v(" "),a("ul",[a("li",[s._v("宿主机的挂载目录：/root/nginx/html")]),s._v(" "),a("li",[s._v("挂载配置：/root/nginx/nginx.conf")]),s._v(" "),a("li",[s._v("所以我们在root目录下新建nginx目录，并进入nginx目录下新建html目录和一个nginx.conf配置文件。")])]),s._v(" "),a("p",[s._v("然后对nginx.conf进行编写，具体配置如下：")]),s._v(" "),a("div",{staticClass:"language-ng line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#user  root;\nworker_processes  1;\nevents {\n    worker_connections  1024;\n}\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n    sendfile        on;\n    keepalive_timeout  65;\n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   /usr/share/nginx/html;\n\t\t\ttry_files $uri $uri/ /index.html last; # 别忘了这个哈\n            index  index.html index.htm;\n        }\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h2",{attrs:{id:"上传前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传前端"}},[s._v("#")]),s._v(" 上传前端")]),s._v(" "),a("p",[s._v("前端打包之后先修改前端调用后端的接口，因为我是虚拟机，所以配置如下")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("axios.js")]),s._v(" "),a("li",[s._v('axios.defaults.baseURL = "http://192.168.0.117:8081"')]),s._v(" "),a("li",[s._v("然后"),a("strong",[s._v("npm run build")]),s._v("打包得到"),a("strong",[s._v("dist")]),s._v("文件夹，并把dist压缩成dist.zip上传到linux之后解压到**/root/nginx/html**目录下")])])]),s._v(" "),a("h2",{attrs:{id:"部署后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署后端"}},[s._v("#")]),s._v(" 部署后端")]),s._v(" "),a("p",[a("code",[s._v("mvn clean package -Dmaven.test.skip=true")]),s._v("  跳过测试打包")]),s._v(" "),a("p",[s._v("首先本地打包"),a("code",[s._v("xxx")]),s._v("项目，xxx-0.0.1-SNAPSHOT.jar，并上传到"),a("code",[s._v("linux")]),s._v("中，同时"),a("code",[s._v("docker-compose.yml")]),s._v("、"),a("code",[s._v("Dockerfile")]),s._v("也上传到同一目录下。")]),s._v(" "),a("p",[s._v("执行下面的命令 "),a("code",[s._v("docker-compose up -d")]),s._v("    其中 -d 表示后台服务形式启动")])])}),[],!1,null,null,null);a.default=e.exports}}]);