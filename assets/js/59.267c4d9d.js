(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{1202:function(a,t,r){"use strict";r.r(t);var s=r(4),e=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"异步任务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#异步任务"}},[a._v("#")]),a._v(" 异步任务")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-job/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[a._v("yudao-spring-boot-starter-job")]),a._v(" "),t("OutboundLink")],1),a._v("技术组件，除了提供定时任务的功能，还提供了 Async 异步任务的能力。系统使用异步任务，提升执行效率。例如说：")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/service/logger/OperateLogServiceImpl.java#L42-L56",target:"_blank",rel:"noopener noreferrer"}},[a._v("操作日志模块 "),t("OutboundLink")],1),a._v("，异步记录【操作日志】")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiAccessLogServiceImpl.java#L39-L44",target:"_blank",rel:"noopener noreferrer"}},[a._v("访问日志模块 "),t("OutboundLink")],1),a._v("，异步记录【访问日志】")])]),a._v(" "),t("p",[a._v("友情提示：")]),a._v(" "),t("p",[a._v("如果你未学习过 Spring 异步任务，可以后续阅读 "),t("a",{attrs:{href:"https://www.iocoder.cn/Spring-Boot/Async-Job/?yudao",target:"_blank",rel:"noopener noreferrer"}},[a._v("《芋道 Spring Boot 异步任务入门 》 "),t("OutboundLink")],1),a._v("文章。")]),a._v(" "),t("h2",{attrs:{id:"_1-async-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-async-配置"}},[a._v("#")]),a._v(" 1. Async 配置")]),a._v(" "),t("p",[a._v("在 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-job/src/main/java/cn/iocoder/yudao/framework/quartz/config/YudaoAsyncAutoConfiguration.java",target:"_blank",rel:"noopener noreferrer"}},[a._v("YudaoAsyncAutoConfiguration "),t("OutboundLink")],1),a._v("配置类，设置使用 "),t("a",{attrs:{href:"https://github.com/alibaba/transmittable-thread-local",target:"_blank",rel:"noopener noreferrer"}},[a._v("TransmittableThreadLocal "),t("OutboundLink")],1),a._v("，解决异步执行时上下文传递的问题。如下图所示：")]),a._v(" "),t("img",{attrs:{src:r(576)}}),a._v(" "),t("p",[a._v("友情提示：")]),a._v(" "),t("p",[a._v("项目使用到 ThreadLocal 的地方，建议都使用 TransmittableThreadLocal 进行替换。")]),a._v(" "),t("h2",{attrs:{id:"_2-引入依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-引入依赖"}},[a._v("#")]),a._v(" 2. 引入依赖")]),a._v(" "),t("p",[a._v("以访问日志模块为例，讲解它如何使用异步任务，实现异步记录【访问日志】的功能。")]),a._v(" "),t("h3",{attrs:{id:"_2-1-引入依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-引入依赖"}},[a._v("#")]),a._v(" 2.1 引入依赖")]),a._v(" "),t("p",[a._v("在 "),t("code",[a._v("yudao-module-system-infra")]),a._v(" 模块中，引入 "),t("code",[a._v("yudao-spring-boot-starter-job")]),a._v(" 技术组件。如下所示：")]),a._v(" "),t("div",{staticClass:"language-xml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("cn.iocoder.boot"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yudao-spring-boot-starter-job"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"_2-2-添加-async-注解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-添加-async-注解"}},[a._v("#")]),a._v(" 2.2 添加 @Async 注解")]),a._v(" "),t("p",[a._v("在 "),t("a",{attrs:{href:"https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-infra/yudao-module-infra-biz/src/main/java/cn/iocoder/yudao/module/infra/service/logger/ApiAccessLogServiceImpl.java#L39-L44",target:"_blank",rel:"noopener noreferrer"}},[a._v("ApiAccessLogServiceImpl "),t("OutboundLink")],1),a._v("的 "),t("code",[a._v("#createApiAccessLogAsync(...)")]),a._v(" 方法上，添加 "),t("code",[a._v("@Async")]),a._v(" 注解，声明它要异步执行。如下图所示：")]),a._v(" "),t("img",{attrs:{src:r(577)}}),a._v(" "),t("h3",{attrs:{id:"_2-3-测试调用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-测试调用"}},[a._v("#")]),a._v(" 2.3 测试调用")]),a._v(" "),t("p",[a._v("随便请求一个 RESTful API 接口，可以看到在异步任务的线程池中，进行了访问日志的记录。如下图所示：")]),a._v(" "),t("img",{attrs:{src:r(578)}})])}),[],!1,null,null,null);t.default=e.exports},576:function(a,t,r){a.exports=r.p+"assets/img/img_198.0705f269.png"},577:function(a,t,r){a.exports=r.p+"assets/img/img_199.cb1e5f5c.png"},578:function(a,t,r){a.exports=r.p+"assets/img/img_200.86244321.png"}}]);